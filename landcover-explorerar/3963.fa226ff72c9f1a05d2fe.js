"use strict";(self.webpackChunkimagery_explorer_apps=self.webpackChunkimagery_explorer_apps||[]).push([[3963],{66318:function(e,t,n){function r(e){return null!=u(e)||null!=i(e)}function o(e){return l.test(e)}function s(e){return u(e)??i(e)}function i(e){const t=new Date(e);return function(e,t){if(Number.isNaN(e.getTime()))return!1;let n=!0;if(c&&/\d+\W*$/.test(t)){const e=t.match(/[a-zA-Z]{2,}/);if(e){let t=!1,r=0;for(;!t&&r<=e.length;)t=!a.test(e[r]),r++;n=!t}}return n}(t,e)?Number.isNaN(t.getTime())?null:t.getTime()-6e4*t.getTimezoneOffset():null}function u(e){const t=l.exec(e);if(!t?.groups)return null;const n=t.groups,r=+n.year,o=+n.month-1,s=+n.day,i=+(n.hours??"0"),u=+(n.minutes??"0"),a=+(n.seconds??"0");if(i>23)return null;if(u>59)return null;if(a>59)return null;const c=n.ms??"0",p=c?+c.padEnd(3,"0").substring(0,3):0;let d;if(n.isUTC||!n.offsetSign)d=Date.UTC(r,o,s,i,u,a,p);else{const e=+n.offsetHours,t=+n.offsetMinutes;d=6e4*("+"===n.offsetSign?-1:1)*(60*e+t)+Date.UTC(r,o,s,i,u,a,p)}return Number.isNaN(d)?null:d}n.d(t,{mu:function(){return o},of:function(){return r},sG:function(){return s}});const l=/^(?:(?<year>-?\d{4,})-(?<month>\d{2})-(?<day>\d{2}))(?:T(?<hours>\d{2}):(?<minutes>\d{2}):(?<seconds>\d{2})(?:\.(?<ms>\d+))?)?(?:(?<isUTC>Z)|(?:(?<offsetSign>\+|-)(?<offsetHours>\d{2}):(?<offsetMinutes>\d{2})))?$/;const a=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,c=!Number.isNaN(new Date("technology 10").getTime())},53963:function(e,t,n){n.r(t),n.d(t,{default:function(){return E}});var r=n(36663),o=(n(91957),n(80020)),s=(n(86004),n(55565),n(16192),n(71297),n(878),n(22836),n(50172),n(72043),n(72506),n(54021)),i=n(15842),u=n(81977),l=(n(39994),n(13802),n(4157),n(40266)),a=n(59659),c=n(38481),p=n(70375),d=n(68309),f=n(53237),y=n(51211),m=n(14685);let g=class extends d.Z{constructor(){super(...arguments),this.featureDefinition=null,this.type="ogc-feature"}load(e){return this.addResolvingPromise(this._loadOGCServices(this.layer,e)),this.when()}getSource(){const{featureDefinition:{collection:e,layerDefinition:t,spatialReference:n,supportedCrs:r},layer:{apiKey:o,customParameters:s,effectiveMaxRecordCount:i}}=this;return{type:"ogc-source",collection:e,layerDefinition:t,maxRecordCount:i,queryParameters:{apiKey:o,customParameters:s},spatialReference:n,supportedCrs:r}}queryExtent(e,t={}){return null}queryFeatureCount(e,t={}){return null}queryFeatures(e,t={}){return this.queryFeaturesJSON(e,t).then((e=>y.Z.fromJSON(e)))}queryFeaturesJSON(e,t={}){const n=this.getSource();return this.load(t).then((()=>(0,f.yN)(n,e,t)))}queryObjectIds(e,t={}){return null}serviceSupportsSpatialReference(e){return!(!e.isWGS84&&!e.isWebMercator&&!this.featureDefinition.supportedCrs[e.wkid])}_conformsToType(e,t){const n=new RegExp(`^${t}$`,"i");return e.conformsTo.some((e=>n.test(e)))??!1}_getCapabilities(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},query:{maxRecordCount:t,maxRecordCountFactor:void 0,standardMaxRecordCount:void 0,supportsCacheHint:!1,supportsCentroid:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByAnonymous:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsStatistics:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,supportsSqlExpression:!1,tileMaxRecordCount:void 0},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUploadWithItemId:!1,supportsUpdateWithoutM:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}_getMaxRecordCount(e){const t=e?.components?.parameters;return t?.limit?.schema?.maximum??t?.limitFeatures?.schema?.maximum}_getStorageSpatialReference(e){const t=e.storageCrs??f.$9,n=(0,f.d)(t);return null==n?m.Z.WGS84:new m.Z({wkid:n})}_getSupportedSpatialReferences(e,t){const n="#/crs",r=e.crs??[f.$9],o=r.includes(n)?r.filter((e=>e!==n)).concat(t.crs??[]):r,s=/^http:\/\/www\.opengis.net\/def\/crs\/epsg\/.*\/3785$/i;return o.filter((e=>!s.test(e)))}async _loadOGCServices(e,t){const n=null!=t?t.signal:null,{apiKey:r,collectionId:o,customParameters:s,fields:i,geometryType:u,hasZ:l,objectIdField:c,timeInfo:d,url:y}=e,m={fields:i?.map((e=>e.toJSON())),geometryType:a.P.toJSON(u),hasZ:l??!1,objectIdField:c,timeInfo:d?.toJSON()},g={apiKey:r,customParameters:s,signal:n},h=await(0,f.gp)(y,g),[b,w]=await Promise.all([(0,f.G4)(h,g),(0,f.j)(h,g)]);if(!this._conformsToType(b,"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/geojson"))throw new p.Z("ogc-feature-layer:no-geojson-support","Server does not support geojson");const v=w.collections.find((({id:e})=>e===o));if(!v)throw new p.Z("ogc-feature-layer:collection-not-found","Server does not contain the named collection");const F=this._conformsToType(b,"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/oas30")?await(0,f.eS)(h,g):null,I=await(0,f.w9)(v,m,g),S=this._getMaxRecordCount(F),C=this._getCapabilities(I.hasZ,S),T=this._getStorageSpatialReference(v).toJSON(),Z=this._getSupportedSpatialReferences(v,w),j=new RegExp(`^${f.Lu}`,"i"),x={};for(const e of Z){const t=(0,f.d)(e);null!=t&&(x[t]||(x[t]=e.replace(j,"")))}this.featureDefinition={capabilities:C,collection:v,layerDefinition:I,spatialReference:T,supportedCrs:x}}};(0,r._)([(0,u.Cb)()],g.prototype,"featureDefinition",void 0),(0,r._)([(0,u.Cb)({constructOnly:!0})],g.prototype,"layer",void 0),(0,r._)([(0,u.Cb)()],g.prototype,"type",void 0),g=(0,r._)([(0,l.j)("esri.layers.graphics.sources.OGCFeatureSource")],g);var h=n(91223),b=n(27668),w=n(63989),v=n(22368),F=n(82733),I=n(43330),S=n(91610),C=n(18241),T=n(12478),Z=n(95874),j=n(2030),x=n(23072),P=n(18160),G=n(12512),_=n(89076),M=n(14845),N=n(26732),R=n(49341),O=n(14136),k=n(10171),D=n(91772);const q=(0,_.v)();let A=class extends((0,h.V)((0,w.N)((0,F.M)((0,v.b)((0,b.h)((0,S.c)((0,j.n)((0,Z.M)((0,I.q)((0,C.I)((0,T.Q)((0,i.R)(c.Z))))))))))))){constructor(e){super(e),this.capabilities=null,this.collectionId=null,this.copyright=null,this.description=null,this.displayField=null,this.elevationInfo=null,this.fields=null,this.fieldsIndex=null,this.fullExtent=null,this.geometryType=null,this.hasZ=void 0,this.labelingInfo=null,this.labelsVisible=!0,this.legendEnabled=!0,this.maxRecordCount=null,this.objectIdField=null,this.operationalLayerType="OGCFeatureLayer",this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=new g({layer:this}),this.spatialReference=null,this.title=null,this.type="ogc-feature",this.typeIdField=null,this.types=null,this.url=null}destroy(){this.source?.destroy()}load(e){return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["OGCFeatureServer"]},e).then((()=>this._fetchService(e)))),this.when()}get defaultPopupTemplate(){return this.createPopupTemplate()}get effectiveMaxRecordCount(){return this.maxRecordCount??this.capabilities?.query.maxRecordCount??5e3}get isTable(){return this.loaded&&null==this.geometryType}set renderer(e){(0,M.YN)(e,this.fieldsIndex),this._set("renderer",e)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return(0,k.eZ)(this,e)}createQuery(){return new O.Z}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){let n,r=!1;const o=t?.feature?.attributes,s=this.typeIdField&&o?.[this.typeIdField];return null!=s&&this.types&&(r=this.types.some((t=>t.id==s&&(n=t.domains?.[e],"inherited"===n?.type&&(n=this._getLayerDomain(e)),!0)))),r||n||(n=this._getLayerDomain(e)),n}queryFeatures(e,t){return this.load().then((()=>this.source.queryFeatures(O.Z.from(e)||this.createQuery(),t))).then((e=>(e?.features?.forEach((e=>{e.layer=e.sourceLayer=this})),e)))}serviceSupportsSpatialReference(e){return this.source?.serviceSupportsSpatialReference(e)??!1}async _fetchService(e){await this.source.load(e),this.read(this.source.featureDefinition,{origin:"service"}),(0,M.YN)(this.renderer,this.fieldsIndex),(0,M.UF)(this.timeInfo,this.fieldsIndex)}_getLayerDomain(e){if(!this.fields)return null;for(const t of this.fields)if(t.name===e&&t.domain)return t.domain;return null}};(0,r._)([(0,u.Cb)({readOnly:!0,json:{origins:{service:{read:!0}}}})],A.prototype,"capabilities",void 0),(0,r._)([(0,u.Cb)({type:String,json:{write:!0}})],A.prototype,"collectionId",void 0),(0,r._)([(0,u.Cb)({type:String})],A.prototype,"copyright",void 0),(0,r._)([(0,u.Cb)({readOnly:!0})],A.prototype,"defaultPopupTemplate",null),(0,r._)([(0,u.Cb)({readOnly:!0,type:String,json:{origins:{service:{name:"collection.description"}}}})],A.prototype,"description",void 0),(0,r._)([(0,u.Cb)({type:String})],A.prototype,"displayField",void 0),(0,r._)([(0,u.Cb)({type:Number})],A.prototype,"effectiveMaxRecordCount",null),(0,r._)([(0,u.Cb)(x.PV)],A.prototype,"elevationInfo",void 0),(0,r._)([(0,u.Cb)({type:[G.Z],json:{origins:{service:{name:"layerDefinition.fields"}}}})],A.prototype,"fields",void 0),(0,r._)([(0,u.Cb)(q.fieldsIndex)],A.prototype,"fieldsIndex",void 0),(0,r._)([(0,u.Cb)({readOnly:!0,type:D.Z,json:{origins:{service:{name:"layerDefinition.extent"}}}})],A.prototype,"fullExtent",void 0),(0,r._)([(0,u.Cb)({type:a.M.apiValues,json:{origins:{service:{name:"layerDefinition.geometryType",read:{reader:a.M.read}}}}})],A.prototype,"geometryType",void 0),(0,r._)([(0,u.Cb)({type:Boolean,json:{origins:{service:{name:"layerDefinition.hasZ"}}}})],A.prototype,"hasZ",void 0),(0,r._)([(0,u.Cb)({type:Boolean,readOnly:!0})],A.prototype,"isTable",null),(0,r._)([(0,u.Cb)({type:[N.Z],json:{origins:{"web-document":{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:R.r},write:!0}}}})],A.prototype,"labelingInfo",void 0),(0,r._)([(0,u.Cb)(x.iR)],A.prototype,"labelsVisible",void 0),(0,r._)([(0,u.Cb)(x.rn)],A.prototype,"legendEnabled",void 0),(0,r._)([(0,u.Cb)({type:Number})],A.prototype,"maxRecordCount",void 0),(0,r._)([(0,u.Cb)({type:String,json:{origins:{service:{name:"layerDefinition.objectIdField"}}}})],A.prototype,"objectIdField",void 0),(0,r._)([(0,u.Cb)({type:["OGCFeatureLayer"]})],A.prototype,"operationalLayerType",void 0),(0,r._)([(0,u.Cb)(x.C_)],A.prototype,"popupEnabled",void 0),(0,r._)([(0,u.Cb)({type:o.Z,json:{name:"popupInfo",write:!0}})],A.prototype,"popupTemplate",void 0),(0,r._)([(0,u.Cb)({types:s.A,json:{origins:{service:{name:"layerDefinition.drawingInfo.renderer",write:!1},"web-scene":{types:s.o,name:"layerDefinition.drawingInfo.renderer",write:!0}},name:"layerDefinition.drawingInfo.renderer",write:!0}})],A.prototype,"renderer",null),(0,r._)([(0,u.Cb)(x.YI)],A.prototype,"screenSizePerspectiveEnabled",void 0),(0,r._)([(0,u.Cb)({readOnly:!0})],A.prototype,"source",void 0),(0,r._)([(0,u.Cb)({readOnly:!0,type:m.Z,json:{origins:{service:{read:!0}}}})],A.prototype,"spatialReference",void 0),(0,r._)([(0,u.Cb)({type:String,json:{write:{enabled:!0,ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"collection.title"}}}})],A.prototype,"title",void 0),(0,r._)([(0,u.Cb)({readOnly:!0,json:{read:!1}})],A.prototype,"type",void 0),(0,r._)([(0,u.Cb)({type:String,readOnly:!0})],A.prototype,"typeIdField",void 0),(0,r._)([(0,u.Cb)({type:[P.Z]})],A.prototype,"types",void 0),(0,r._)([(0,u.Cb)(x.HQ)],A.prototype,"url",void 0),A=(0,r._)([(0,l.j)("esri.layers.OGCFeatureLayer")],A);const E=A},10287:function(e,t,n){n.d(t,{g:function(){return r}});const r={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},12065:function(e,t,n){n.d(t,{$:function(){return re},$g:function(){return oe},EI:function(){return U},GH:function(){return H},IN:function(){return F},Iv:function(){return R},J6:function(){return k},Jd:function(){return v},Nh:function(){return X},RZ:function(){return K},Uy:function(){return A},XA:function(){return Q},Yn:function(){return z},cn:function(){return J},dd:function(){return N},di:function(){return B},eG:function(){return q},fQ:function(){return S},hY:function(){return se},h_:function(){return V},ks:function(){return E},lM:function(){return Y},lz:function(){return ue},zj:function(){return ee}});var r=n(70375),o=n(13802),s=n(61681),i=n(37116),u=n(24568),l=n(53736),a=n(59958),c=n(61619),p=n(15540);function d(e,t){return e?t?4:3:t?3:2}const f=()=>o.Z.getLogger("esri.layers.graphics.featureConversionUtils"),y={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},m=(e,t,n,r,o,s)=>{e[n]=o,e[n+1]=s},g=(e,t,n,r,o,s)=>{e[n]=o,e[n+1]=s,e[n+2]=t[r+2]},h=(e,t,n,r,o,s)=>{e[n]=o,e[n+1]=s,e[n+2]=t[r+3]},b=(e,t,n,r,o,s)=>{e[n]=o,e[n+1]=s,e[n+2]=t[r+2],e[n+3]=t[r+3]};function w(e,t,n,r){if(e){if(n)return t&&r?b:g;if(t&&r)return h}else if(t&&r)return g;return m}function v({scale:e,translate:t},n){return Math.round((n-t[0])/e[0])}function F({scale:e,translate:t},n){return Math.round((t[1]-n)/e[1])}function I({scale:e,translate:t},n,r){return n*e[r]+t[r]}function S(e,t,n){return e?t?n?G(e):Z(e):n?x(e):C(e):null}function C(e){const t=e.coords;return{x:t[0],y:t[1]}}function T(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function Z(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function j(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function x(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function P(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function G(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function _(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function M(e,t){return e&&t?_:e?j:t?P:T}function N(e,t,n=M(null!=t.z,null!=t.m)){return n(e,t)}function R(e,t,n){if(null==e)return null;const r=d(t,n),o=[];for(let t=0;t<e.coords.length;t+=r){const n=[];for(let o=0;o<r;o++)n.push(e.coords[t+o]);o.push(n)}return t?n?{points:o,hasZ:t,hasM:n}:{points:o,hasZ:t}:n?{points:o,hasM:n}:{points:o}}function O(e,t,n=d(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const r=e.coords;let o=0;for(const e of t.points)for(let t=0;t<n;t++)r[o++]=e[t];return e}function k(e,t,n){if(!e)return null;const r=d(t,n),{coords:o,lengths:s}=e,i=[];let u=0;for(const e of s){const t=[];for(let n=0;n<e;n++){const e=[];for(let t=0;t<r;t++)e.push(o[u++]);t.push(e)}i.push(t)}return t?n?{paths:i,hasZ:t,hasM:n}:{paths:i,hasZ:t}:n?{paths:i,hasM:n}:{paths:i}}function D(e,t,n=d(t.hasZ,t.hasM)){const{lengths:r,coords:o}=e;let s=0;for(const e of t.paths){for(const t of e)for(let e=0;e<n;e++)o[s++]=t[e];r.push(e.length)}return e}function q(e,t,n){if(!e)return null;const r=d(t,n),{coords:o,lengths:s}=e,i=[];let u=0;for(const e of s){const t=[];for(let n=0;n<e;n++){const e=[];for(let t=0;t<r;t++)e.push(o[u++]);t.push(e)}i.push(t)}return t?n?{rings:i,hasZ:t,hasM:n}:{rings:i,hasZ:t}:n?{rings:i,hasM:n}:{rings:i}}function A(e,t,n=t.hasZ,r=t.hasM){return E(e,t.rings,n,r)}function E(e,t,n,r){const o=d(n,r),{lengths:s,coords:i}=e;let u=0;le(e);for(const e of t){for(const t of e)for(let e=0;e<o;e++)i[u++]=t[e];s.push(e.length)}return e}const $=[],L=[];function Q(e,t,n,r,o){$[0]=e;const[s]=z(L,$,t,n,r,o);return ae($),ae(L),s}function z(e,t,n,o,s,i){if(ae(e),!n){for(const n of t){const t=i?n.attributes[i]:void 0;e.push(new a.u_(null,n.attributes,null,t))}return e}switch(n){case"esriGeometryPoint":return function(e,t,n,r,o){const s=M(n,r);for(const{geometry:n,attributes:r}of t){const t=null!=n?s(new p.Z,n):null;e.push(new a.u_(t,r,null,o?r[o]:void 0))}return e}(e,t,o,s,i);case"esriGeometryMultipoint":return function(e,t,n,r,o){const s=d(n,r);for(const{geometry:n,attributes:r}of t){const t=null!=n?O(new p.Z,n,s):null;e.push(new a.u_(t,r,null,o?r[o]:void 0))}return e}(e,t,o,s,i);case"esriGeometryPolyline":return function(e,t,n,r,o){const s=d(n,r);for(const{geometry:n,attributes:r,centroid:i}of t){const t=null!=n?D(new p.Z,n,s):null,u=null!=i?N(new p.Z,i):null;e.push(new a.u_(t,r,u,o?r[o]:void 0))}return e}(e,t,o,s,i);case"esriGeometryPolygon":return function(e,t,n,r,o){for(const{geometry:s,centroid:i,attributes:u}of t){const t=null!=s?A(new p.Z,s,n,r):null,l=o?u[o]:void 0;null!=i?e.push(new a.u_(t,u,T(new p.Z,i),l)):e.push(new a.u_(t,u,null,l))}return e}(e,t,o,s,i);default:f().error("convertToFeatureSet:unknown-geometry",new r.Z(`Unable to parse unknown geometry type '${n}'`)),ae(e)}return e}function U(e,t,n,r){L[0]=e,W($,L,t,n,r);const o=$[0];return ae($),ae(L),o}function H(e,t,n){if(null==e)return null;const o=new p.Z;return"hasZ"in e&&null==t&&(t=e.hasZ),"hasM"in e&&null==n&&(n=e.hasM),(0,l.wp)(e)?M(null!=t?t:null!=e.z,null!=n?n:null!=e.m)(o,e):(0,l.oU)(e)?A(o,e,t,n):(0,l.l9)(e)?D(o,e,d(t,n)):(0,l.aW)(e)?O(o,e,d(t,n)):void f().error("convertFromGeometry:unknown-geometry",new r.Z(`Unable to parse unknown geometry type '${e}'`))}function B(e,t,n,o){const s=e&&("coords"in e?e:e.geometry);if(null==s)return null;switch(t){case"esriGeometryPoint":{let e=C;return n&&o?e=G:n?e=Z:o&&(e=x),e(s)}case"esriGeometryMultipoint":return R(s,n,o);case"esriGeometryPolyline":return k(s,n,o);case"esriGeometryPolygon":return q(s,n,o);default:return f().error("convertToGeometry:unknown-geometry",new r.Z(`Unable to parse unknown geometry type '${t}'`)),null}}function W(e,t,n,o,s){if(ae(e),null==n)return function(e,t){for(const n of t)e.push({attributes:n.attributes});return e}(e,t);switch(n){case"esriGeometryPoint":return function(e,t,n,r){let o=C;n&&r?o=G:n?o=Z:r&&(o=x);for(const n of t){const{geometry:t,attributes:r}=n,s=null!=t?o(t):null;e.push({attributes:r,geometry:s})}return e}(e,t,o,s);case"esriGeometryMultipoint":return function(e,t,n,r){for(const{geometry:o,attributes:s}of t)e.push({attributes:s,geometry:null!=o?R(o,n,r):null});return e}(e,t,o,s);case"esriGeometryPolyline":return function(e,t,n,r){for(const{geometry:o,attributes:s}of t)e.push({attributes:s,geometry:null!=o?k(o,n,r):null});return e}(e,t,o,s);case"esriGeometryPolygon":return function(e,t,n,r){for(const{geometry:o,attributes:s,centroid:i}of t){const t=null!=o?q(o,n,r):null;if(null!=i){const n=C(i);e.push({attributes:s,centroid:n,geometry:t})}else e.push({attributes:s,geometry:t})}return e}(e,t,o,s);default:f().error("convertToFeatureSet:unknown-geometry",new r.Z(`Unable to parse unknown geometry type '${n}'`))}return e}function J(e){const{objectIdFieldName:t,spatialReference:n,transform:r,fields:o,hasM:s,hasZ:i,features:u,geometryType:l,exceededTransferLimit:a,uniqueIdField:c,queryGeometry:p,queryGeometryType:d}=e,f={features:W([],u,l,i,s),fields:o,geometryType:l,objectIdFieldName:t,spatialReference:n,uniqueIdField:c,queryGeometry:B(p,d,!1,!1)};return r&&(f.transform=r),a&&(f.exceededTransferLimit=a),s&&(f.hasM=s),i&&(f.hasZ=i),f}function V(e,t){const n=new c.Z,{hasM:o,hasZ:s,features:i,objectIdFieldName:u,spatialReference:l,geometryType:a,exceededTransferLimit:p,transform:d,fields:y}=e;return y&&(n.fields=y),n.geometryType=a??null,n.objectIdFieldName=u??t??null,n.spatialReference=l??null,n.objectIdFieldName?(i&&z(n.features,i,a,s,o,n.objectIdFieldName),p&&(n.exceededTransferLimit=p),o&&(n.hasM=o),s&&(n.hasZ=s),d&&(n.transform=d),n):(f().error(new r.Z("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),n)}function Y(e){const{transform:t,features:n,hasM:r,hasZ:o}=e;if(!t)return e;for(const e of n)null!=e.geometry&&oe(e.geometry,e.geometry,r,o,t),null!=e.centroid&&oe(e.centroid,e.centroid,r,o,t);return e.transform=null,e}function K(e,t){const{geometryType:n,features:r,hasM:o,hasZ:s}=t;if(!e)return t;for(let t=0;t<r.length;t++){const i=r[t],u=i.weakClone();u.geometry=new p.Z,X(u.geometry,i.geometry,o,s,n,e),i.centroid&&(u.centroid=new p.Z,X(u.centroid,i.centroid,o,s,"esriGeometryPoint",e)),r[t]=u}return t.transform=e,t}function X(e,t,n,r,o,s,i=n,u=r){if(le(e),!t?.coords.length)return null;const l=y[o],{coords:a,lengths:c}=t,p=d(n,r),f=d(n&&i,r&&u),m=w(n,r,i,u);if(!c.length)return m(e.coords,a,0,0,v(s,a[0]),F(s,a[1])),le(e,p,0),e;let g,h,b,I,S=0,C=0,T=C;for(const t of c){if(t<l)continue;let n=0;C=T,b=g=v(s,a[S]),I=h=F(s,a[S+1]),m(e.coords,a,C,S,b,I),n++,S+=p,C+=f;for(let r=1;r<t;r++,S+=p)b=v(s,a[S]),I=F(s,a[S+1]),b===g&&I===h||(m(e.coords,a,C,S,b-g,I-h),C+=f,n++,g=b,h=I);n>=l&&(e.lengths.push(n),T=C)}return ae(e.coords,T),e.coords.length?e:null}function ee(e,t,n,r,o,s,i=n,u=r){if(le(e),!t?.coords.length)return null;const l=y[o],{coords:a,lengths:c}=t,p=d(n,r),f=d(n&&i,r&&u),m=w(n,r,i,u);if(!c.length)return m(e.coords,a,0,0,a[0],a[1]),le(e,p,0),e;let g=0;const h=s*s;for(const t of c){if(t<l){g+=t*p;continue}const n=e.coords.length/f,r=g,o=g+(t-1)*p;m(e.coords,a,e.coords.length,r,a[r],a[r+1]),ne(e.coords,a,p,h,m,r,o),m(e.coords,a,e.coords.length,o,a[o],a[o+1]);const s=e.coords.length/f-n;s>=l?e.lengths.push(s):ae(e.coords,n*f),g+=t*p}return e.coords.length?e:null}function te(e,t,n,r){const o=e[t],s=e[t+1],i=e[n],u=e[n+1],l=e[r],a=e[r+1];let c=i,p=u,d=l-c,f=a-p;if(0!==d||0!==f){const e=((o-c)*d+(s-p)*f)/(d*d+f*f);e>1?(c=l,p=a):e>0&&(c+=d*e,p+=f*e)}return d=o-c,f=s-p,d*d+f*f}function ne(e,t,n,r,o,s,i){let u,l=r,a=0;for(let e=s+n;e<i;e+=n)u=te(t,e,s,i),u>l&&(a=e,l=u);l>r&&(a-s>n&&ne(e,t,n,r,o,s,a),o(e,t,e.length,a,t[a],t[a+1]),i-a>n&&ne(e,t,n,r,o,a,i))}function re(e,t,n,r){if(!t?.coords?.length)return null;const o=d(n,r);let s=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;if(t&&t.coords){const e=t.coords;for(let t=0;t<e.length;t+=o){const n=e[t],r=e[t+1];s=Math.min(s,n),a=Math.max(a,n),l=Math.min(l,r),c=Math.max(c,r)}}return(0,i.is)(e)?(0,i.bZ)(e,s,l,a,c):(0,u.al)(s,l,a,c,e),e}function oe(e,t,n,r,o){const{coords:i,lengths:u}=t,l=d(n,r);if(!i.length)return e!==t&&le(e),e;(0,s.O3)(o);const{originPosition:a,scale:c,translate:p}=o,f=ce;f.originPosition=a;const y=f.scale;y[0]=c[0]??1,y[1]=-(c[1]??1),y[2]=c[2]??1,y[3]=c[3]??1;const m=f.translate;if(m[0]=p[0]??0,m[1]=p[1]??0,m[2]=p[2]??0,m[3]=p[3]??0,!u.length){for(let t=0;t<l;++t)e.coords[t]=I(f,i[t],t);return e!==t&&le(e,l,0),e}let g=0;for(let t=0;t<u.length;t++){const n=u[t];e.lengths[t]=n;for(let t=0;t<l;++t)e.coords[g+t]=I(f,i[g+t],t);let r=e.coords[g],o=e.coords[g+1];g+=l;for(let t=1;t<n;t++,g+=l){r+=i[g]*y[0],o+=i[g+1]*y[1],e.coords[g]=r,e.coords[g+1]=o;for(let t=2;t<l;++t)e.coords[g+t]=I(f,i[g+t],t)}}return e!==t&&le(e,i.length,u.length),e}function se(e,t,n,r,o,s){if(le(e),e.lengths.push(...t.lengths),n===o&&r===s)for(let n=0;n<t.coords.length;n++)e.coords.push(t.coords[n]);else{const i=d(n,r),u=w(n,r,o,s),l=t.coords;for(let t=0;t<l.length;t+=i)u(e.coords,l,e.coords.length,t,l[t],l[t+1])}return e}function ie(e,t,n,r){let o=0,s=e[r*t],i=e[r*(t+1)];for(let u=1;u<n;u++){const n=s+e[r*(t+u)],l=i+e[r*(t+u)+1],a=(n-s)*(l+i);s=n,i=l,o+=a}return.5*o}function ue(e,t){const{coords:n,lengths:r}=e;let o=0,s=0;for(let e=0;e<r.length;e++){const i=r[e];s+=ie(n,o,i,t),o+=i}return Math.abs(s)}function le(e,t=0,n=0){ae(e.lengths,n),ae(e.coords,t)}function ae(e,t=0){e.length!==t&&(e.length=t)}const ce={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]}},61957:function(e,t,n){n.d(t,{O3:function(){return S},lG:function(){return T},my:function(){return C},q9:function(){return c}});var r=n(66318),o=n(70375),s=n(35925),i=n(59958),u=n(15540),l=n(14845);const a={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function c(e){return a[e]}function*p(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const t of e.features)t&&(yield t)}}function*d(e){if(e)switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const t of e.coordinates)yield*t;break;case"MultiPolygon":for(const t of e.coordinates)for(const e of t)yield*e}}function f(e){for(const t of e)if(t.length>2)return!0;return!1}function y(e){let t=0;for(let n=0;n<e.length;n++){const r=e[n],o=e[(n+1)%e.length];t+=r[0]*o[1]-o[0]*r[1]}return t<=0}function m(e){const t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]||e.push(t),e}function g(e,t,n){switch(t.type){case"LineString":case"MultiPoint":return function(e,t,n){return w(e,t.coordinates,n),e}(e,t,n);case"MultiLineString":return function(e,t,n){for(const r of t.coordinates)w(e,r,n);return e}(e,t,n);case"MultiPolygon":return function(e,t,n){for(const r of t.coordinates){h(e,r[0],n);for(let t=1;t<r.length;t++)b(e,r[t],n)}return e}(e,t,n);case"Point":return function(e,t,n){return F(e,t.coordinates,n),e}(e,t,n);case"Polygon":return function(e,t,n){const r=t.coordinates;h(e,r[0],n);for(let t=1;t<r.length;t++)b(e,r[t],n);return e}(e,t,n)}}function h(e,t,n){const r=m(t);!function(e){return!y(e)}(r)?w(e,r,n):v(e,r,n)}function b(e,t,n){const r=m(t);!function(e){return y(e)}(r)?w(e,r,n):v(e,r,n)}function w(e,t,n){for(const r of t)F(e,r,n);e.lengths.push(t.length)}function v(e,t,n){for(let r=t.length-1;r>=0;r--)F(e,t[r],n);e.lengths.push(t.length)}function F(e,t,n){const[r,o,s]=t;e.coords.push(r,o),n.hasZ&&e.coords.push(s||0)}function I(e){switch(typeof e){case"string":return(0,r.mu)(e)?"esriFieldTypeDate":"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function S(e,t=4326){if(!e)throw new o.Z("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new o.Z("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:n}=e;if(!n)return;const r="string"==typeof n?n:"name"===n.type?n.properties.name:"EPSG"===n.type?n.properties.code:null,i=(0,s.oR)({wkid:t})?new RegExp(".*(CRS84H?|4326)$","i"):new RegExp(`.*(${t})$`,"i");if(!r||!i.test(r))throw new o.Z("geojson:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:n})}function C(e,t={}){const n=[],r=new Set,o=new Set;let s,i=!1,u=null,a=!1,{geometryType:y=null}=t,m=!1;for(const t of p(e)){const{geometry:e,properties:p,id:g}=t;if((!e||(y||(y=c(e.type)),c(e.type)===y))&&(i||(i=f(d(e))),a||(a=null!=g,a&&(s=typeof g,p&&(u=Object.keys(p).filter((e=>p[e]===g))))),p&&u&&a&&null!=g&&(u.length>1?u=u.filter((e=>p[e]===g)):1===u.length&&(u=p[u[0]]===g?u:[])),!m&&p)){let e=!0;for(const t in p){if(r.has(t))continue;const s=p[t];if(null==s){e=!1,o.add(t);continue}const i=I(s);if("unknown"===i){o.add(t);continue}o.delete(t),r.add(t);const u=(0,l.q6)(t);u&&n.push({name:u,alias:t,type:i})}m=e}}const g=(0,l.q6)(1===u?.length&&u[0]||null)??void 0;if(g)for(const e of n)if(e.name===g&&(0,l.H7)(e)){e.type="esriFieldTypeOID";break}return{fields:n,geometryType:y,hasZ:i,objectIdFieldName:g,objectIdFieldType:s,unknownFields:Array.from(o)}}function T(e,t){return Array.from(function*(e,t={}){const{geometryType:n,objectIdField:r}=t;for(const o of e){const{geometry:e,properties:s,id:l}=o;if(e&&c(e.type)!==n)continue;const a=s||{};let p;r&&(p=a[r],null==l||p||(a[r]=p=l));const d=new i.u_(e?g(new u.Z,e,t):null,a,null,p??void 0);yield d}}(p(e),t))}},40400:function(e,t,n){n.d(t,{Dm:function(){return c},Hq:function(){return p},MS:function(){return d},bU:function(){return u}});var r=n(39994),o=n(67134),s=n(10287),i=n(86094);function u(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?i.I4:"esriGeometryPolyline"===e?i.ET:i.lF}}}const l=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let a=1;function c(e,t){if((0,r.Z)("esri-csp-restrictions"))return()=>({[t]:null,...e});try{let n=`this.${t} = null;`;for(const t in e)n+=`this${l.test(t)?`.${t}`:`["${t}"]`} = ${JSON.stringify(e[t])};`;const r=new Function(`\n      return class AttributesClass$${a++} {\n        constructor() {\n          ${n};\n        }\n      }\n    `)();return()=>new r}catch(n){return()=>({[t]:null,...e})}}function p(e={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,o.d9)(e)}}]}function d(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:s.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}},24366:function(e,t,n){n.d(t,{O0:function(){return d},av:function(){return l},b:function(){return g},d1:function(){return c},og:function(){return m}});var r=n(66318),o=n(35925),s=n(14845);class i{constructor(){this.code=null,this.description=null}}class u{constructor(e){this.error=new i,this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error.description=e}}function l(e){return new u(e)}class a{constructor(e){this.globalId=null,this.success=!0,this.objectId=this.uniqueId=e}}function c(e){return new a(e)}const p=new Set;function d(e,t,n,r=!1){p.clear();for(const o in n){const i=e.get(o);if(!i)continue;const u=f(i,n[o]);if(p.add(i.name),i&&(r||i.editable)){const e=(0,s.Qc)(i,u);if(e)return l((0,s.vP)(e,i,u));t[i.name]=u}}for(const t of e?.requiredFields??[])if(!p.has(t.name))return l(`missing required field "${t.name}"`);return null}function f(e,t){let n=t;return(0,s.H7)(e)&&"string"==typeof t?n=parseFloat(t):(0,s.qN)(e)&&null!=t&&"string"!=typeof t?n=String(t):(0,s.y2)(e)&&"string"==typeof t&&(n=(0,r.sG)(t)),(0,s.Pz)(n)}let y;function m(e,t){if(!e||!(0,o.JY)(t))return e;if("rings"in e||"paths"in e){if(null==y)throw new TypeError("geometry engine not loaded");return y.simplify(t,e)}return e}async function g(e,t){!(0,o.JY)(e)||"esriGeometryPolygon"!==t&&"esriGeometryPolyline"!==t||await async function(){return null==y&&(y=await Promise.all([n.e(9067),n.e(3296)]).then(n.bind(n,8923))),y}()}},53237:function(e,t,n){n.d(t,{$9:function(){return I},G4:function(){return j},Lu:function(){return F},WW:function(){return M},d:function(){return G},eS:function(){return P},gp:function(){return x},j:function(){return Z},w9:function(){return T},yN:function(){return _}});n(91957);var r=n(66341),o=n(70375),s=n(13802),i=n(3466),u=n(35925),l=n(39536),a=n(12065),c=n(61619),p=n(61957),d=n(40400),f=n(24366),y=n(28790),m=n(86349),g=n(72559),h=n(14685);const b=()=>s.Z.getLogger("esri.layers.ogc.ogcFeatureUtils"),w="startindex",v=new Set([w,"offset"]),F="http://www.opengis.net/def/crs/",I=`${F}OGC/1.3/CRS84`;var S,C;async function T(e,t,n={},s=5){const{links:u}=e,l=D(u,"items",S.geojson)||D(u,"http://www.opengis.net/def/rel/ogc/1.0/items",S.geojson);if(null==l)throw new o.Z("ogc-feature-layer:missing-items-page","Missing items url");const{apiKey:a,customParameters:c,signal:f}=n,h=(0,i.hF)(l.href,e.landingPage.url),v={limit:s,...c,token:a},F=(0,i.fl)(h,v),I={accept:S.geojson},{data:C}=await(0,r.Z)(F,{signal:f,headers:I}),T=q(F,s,C.links)??w;(0,p.O3)(C);const Z=(0,p.my)(C,{geometryType:t.geometryType}),j=t.fields||Z.fields||[],x=null!=t.hasZ?t.hasZ:Z.hasZ,P=Z.geometryType,G=t.objectIdField||Z.objectIdFieldName||"OBJECTID";let _=t.timeInfo;const M=j.find((({name:e})=>e===G));if(M)M.editable=!1,M.nullable=!1;else{if(!Z.objectIdFieldType)throw new o.Z("ogc-feature-layer:missing-feature-id","Collection geojson require a feature id as a unique identifier");j.unshift({name:G,alias:G,type:"number"===Z.objectIdFieldType?"esriFieldTypeOID":"esriFieldTypeString",editable:!1,nullable:!1})}if(G!==Z.objectIdFieldName){const e=j.find((({name:e})=>e===Z.objectIdFieldName));e&&(e.type="esriFieldTypeInteger")}j===Z.fields&&Z.unknownFields.length>0&&b().warn({name:"ogc-feature-layer:unknown-field-types",message:"Some fields types couldn't be inferred from the features and were dropped",details:{unknownFields:Z.unknownFields}});for(const e of j){if(null==e.name&&(e.name=e.alias),null==e.alias&&(e.alias=e.name),"esriFieldTypeOID"!==e.type&&"esriFieldTypeGlobalID"!==e.type&&(e.editable=null==e.editable||!!e.editable,e.nullable=null==e.nullable||!!e.nullable),!e.name)throw new o.Z("ogc-feature-layer:invalid-field-name","field name is missing",{field:e});if(!m.v.jsonValues.includes(e.type))throw new o.Z("ogc-feature-layer:invalid-field-type",`invalid type for field "${e.name}"`,{field:e})}if(_){const e=new y.Z(j);if(_.startTimeField){const t=e.get(_.startTimeField);t?(_.startTimeField=t.name,t.type="esriFieldTypeDate"):_.startTimeField=null}if(_.endTimeField){const t=e.get(_.endTimeField);t?(_.endTimeField=t.name,t.type="esriFieldTypeDate"):_.endTimeField=null}if(_.trackIdField){const t=e.get(_.trackIdField);t?_.trackIdField=t.name:(_.trackIdField=null,b().warn({name:"ogc-feature-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:_}}))}_.timeReference||={timeZoneIANA:g.pt},_.startTimeField||_.endTimeField||(b().warn({name:"ogc-feature-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing",details:{timeInfo:_}}),_=null)}return{drawingInfo:P?(0,d.bU)(P):null,extent:k(e),geometryType:P,fields:j,hasZ:!!x,objectIdField:G,paginationParameter:T,timeInfo:_}}async function Z(e,t={}){const{links:n,url:s}=e,u=D(n,"data",S.json)||D(n,"http://www.opengis.net/def/rel/ogc/1.0/data",S.json);if(null==u)throw new o.Z("ogc-feature-layer:missing-collections-page","Missing collections url");const{apiKey:l,customParameters:a,signal:c}=t,p=(0,i.hF)(u.href,s),{data:d}=await(0,r.Z)(p,{signal:c,headers:{accept:S.json},query:{...a,token:l}});for(const t of d.collections)t.landingPage=e;return d}async function j(e,t={}){const{links:n,url:s}=e,u=D(n,"conformance",S.json)||D(n,"http://www.opengis.net/def/rel/ogc/1.0/conformance",S.json);if(null==u)throw new o.Z("ogc-feature-layer:missing-conformance-page","Missing conformance url");const{apiKey:l,customParameters:a,signal:c}=t,p=(0,i.hF)(u.href,s),{data:d}=await(0,r.Z)(p,{signal:c,headers:{accept:S.json},query:{...a,token:l}});return d}async function x(e,t={}){const{apiKey:n,customParameters:o,signal:s}=t,{data:i}=await(0,r.Z)(e,{signal:s,headers:{accept:S.json},query:{...o,token:n}});return i.url=e,i}async function P(e,t={}){const{links:n,url:o}=e,s=D(n,"service-desc",S.openapi);if(null==s)return b().warn("ogc-feature-layer:missing-openapi-page","The OGC API-Features server does not have an OpenAPI page."),null;const{apiKey:u,customParameters:l,signal:a}=t,c=(0,i.hF)(s.href,o),{data:p}=await(0,r.Z)(c,{signal:a,headers:{accept:S.openapi},query:{...l,token:u}});return p}function G(e){const t=/^http:\/\/www\.opengis.net\/def\/crs\/(?<authority>.*)\/(?<version>.*)\/(?<code>.*)$/i.exec(e),n=t?.groups;if(!n)return null;const{authority:r,code:o}=n;switch(r.toLowerCase()){case"ogc":switch(o.toLowerCase()){case"crs27":return h.Z.GCS_NAD_1927.wkid;case"crs83":return 4269;case"crs84":case"crs84h":return h.Z.WGS84.wkid;default:return null}case"esri":case"epsg":{const e=Number.parseInt(o,10);return Number.isNaN(e)?null:e}default:return null}}async function _(e,t,n){const r=await M(e,t,n);return(0,a.cn)(r)}async function M(e,t,n){const{collection:{links:s,landingPage:{url:d}},layerDefinition:m,maxRecordCount:g,queryParameters:{apiKey:b,customParameters:w},spatialReference:v,supportedCrs:F}=e,I=D(s,"items",S.geojson)||D(s,"http://www.opengis.net/def/rel/ogc/1.0/items",S.geojson);if(null==I)throw new o.Z("ogc-feature-layer:missing-items-page","Missing items url");const{geometry:C,num:T,start:Z,timeExtent:j,where:x}=t;if(t.objectIds)throw new o.Z("ogc-feature-layer:query-by-objectids-not-supported","Queries with object ids are not supported");const P=h.Z.fromJSON(v),G=t.outSpatialReference??P,_=G.isWGS84?null:N(G,F),M=O(C,F),R=function(e){if(null==e)return null;const{start:t,end:n}=e;return`${null!=t?t.toISOString():".."}/${null!=n?n.toISOString():".."}`}(j),k=null!=(V=x)&&V&&"1=1"!==V?V:null,q=T??(null==Z?g:10),A=0===Z?void 0:Z,{fields:E,geometryType:$,hasZ:L,objectIdField:Q,paginationParameter:z}=m,U=(0,i.hF)(I.href,d),{data:H}=await(0,r.Z)(U,{...n,query:{...w,...M,crs:_,datetime:R,query:k,limit:q,[z]:A,token:b},headers:{accept:S.geojson}}),B=(0,p.lG)(H,{geometryType:$,hasZ:L,objectIdField:Q}),W=B.length===q&&!!D(H.links??[],"next",S.geojson),J=new y.Z(E);var V;for(const e of B){const t={};(0,f.O0)(J,t,e.attributes),t[Q]=e.attributes[Q],e.attributes=t}if(!_&&G.isWebMercator)for(const e of B)if(null!=e.geometry&&null!=$){const t=(0,a.di)(e.geometry,$,L,!1);t.spatialReference=h.Z.WGS84,e.geometry=(0,a.GH)((0,l.iV)(t,G))}for(const e of B)e.objectId=e.attributes[Q];const Y=_||!_&&G.isWebMercator?G.toJSON():u.YU,K=new c.Z;return K.exceededTransferLimit=W,K.features=B,K.fields=E,K.geometryType=$,K.hasZ=L,K.objectIdFieldName=Q,K.spatialReference=Y,K}function N(e,t){const{isWebMercator:n,wkid:r}=e;if(!r)return null;const o=n?t[3857]??t[102100]??t[102113]??t[900913]:t[e.wkid];return o?`${F}${o}`:null}function R(e){if(null==e)return"";const{xmin:t,ymin:n,xmax:r,ymax:o}=e;return`${t},${n},${r},${o}`}function O(e,t){if(!function(e){return null!=e&&"extent"===e.type}(e))return null;const{spatialReference:n}=e;if(!n||n.isWGS84)return{bbox:R(e)};const r=N(n,t);return null!=r?{bbox:R(e),"bbox-crs":r}:n.isWebMercator?{bbox:R((0,l.iV)(e,h.Z.WGS84))}:null}function k(e){const t=e.extent?.spatial;if(!t)return null;const n=t.bbox[0],r=4===n.length,[o,s]=n,i=r?void 0:n[2];return{xmin:o,ymin:s,xmax:r?n[2]:n[3],ymax:r?n[3]:n[4],zmin:i,zmax:r?void 0:n[5],spatialReference:h.Z.WGS84.toJSON()}}function D(e,t,n){return e.find((({rel:e,type:r})=>e===t&&r===n))??e.find((({rel:e,type:n})=>e===t&&!n))}function q(e,t,n){if(!n)return;const r=D(n,"next",S.geojson),o=(0,i.mN)(r?.href)?.query;if(!o)return;const s=(0,i.mN)(e).query,u=Object.keys(s??{}),l=Object.entries(o).filter((([e])=>!u.includes(e))).find((([e,n])=>v.has(e.toLowerCase())&&Number.parseInt(n,10)===t)),a=l?.[0];return a}(C=S||(S={})).json="application/json",C.geojson="application/geo+json",C.openapi="application/vnd.oai.openapi+json;version=3.0"}}]);