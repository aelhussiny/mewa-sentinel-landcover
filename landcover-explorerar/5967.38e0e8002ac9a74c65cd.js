"use strict";(self.webpackChunkimagery_explorer_apps=self.webpackChunkimagery_explorer_apps||[]).push([[5967,8611],{50516:function(e,t,r){r.d(t,{D:function(){return o}});var a=r(71760);function o(e){e?.writtenProperties&&e.writtenProperties.forEach((({target:e,propName:t,newOrigin:r})=>{(0,a.l)(e)&&r&&e.originOf(t)!==r&&e.updateOrigin(t,r)}))}},71760:function(e,t,r){function a(e){return e&&"getAtOrigin"in e&&"originOf"in e}r.d(t,{l:function(){return a}})},68611:function(e,t,r){r.d(t,{FO:function(){return d},W7:function(){return f},addOrUpdateResources:function(){return i},fetchResources:function(){return s},removeAllResources:function(){return l},removeResource:function(){return c}});var a=r(66341),o=r(70375),n=r(3466);async function s(e,t={},r){await e.load(r);const a=(0,n.v_)(e.itemUrl,"resources"),{start:o=1,num:s=10,sortOrder:i="asc",sortField:c="resource"}=t,l={query:{start:o,num:s,sortOrder:i,sortField:c,token:e.apiKey},signal:r?.signal},u=await e.portal.request(a,l);return{total:u.total,nextStart:u.nextStart,resources:u.resources.map((({created:t,size:r,resource:a})=>({created:new Date(t),size:r,resource:e.resourceFromPath(a)})))}}async function i(e,t,r,a){const s=new Map;for(const{resource:e,content:a,compress:n,access:i}of t){if(!e.hasPath())throw new o.Z(`portal-item-resource-${r}:invalid-path`,"Resource does not have a valid path");const[t,c]=u(e.path),l=`${t}/${n??""}/${i??""}`;s.has(l)||s.set(l,{prefix:t,compress:n,access:i,files:[]}),s.get(l).files.push({fileName:c,content:a})}await e.load(a);const i=(0,n.v_)(e.userItemUrl,"add"===r?"addResources":"updateResources");for(const{prefix:t,compress:r,access:o,files:n}of s.values()){const s=25;for(let c=0;c<n.length;c+=s){const l=n.slice(c,c+s),u=new FormData;t&&"."!==t&&u.append("resourcesPrefix",t),r&&u.append("compress","true"),o&&u.append("access",o);let p=0;for(const{fileName:e,content:t}of l)u.append("file"+ ++p,t,e);u.append("f","json"),await e.portal.request(i,{method:"post",body:u,signal:a?.signal})}}}async function c(e,t,r){if(!t.hasPath())throw new o.Z("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(r);const a=(0,n.v_)(e.userItemUrl,"removeResources");await e.portal.request(a,{method:"post",query:{resource:t.path},signal:r?.signal}),t.portalItem=null}async function l(e,t){await e.load(t);const r=(0,n.v_)(e.userItemUrl,"removeResources");return e.portal.request(r,{method:"post",query:{deleteAll:!0},signal:t?.signal})}function u(e){const t=e.lastIndexOf("/");return-1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}function p(e){const[t,r]=function(e){const t=(0,n.Ml)(e);return null==t?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}(e),[a,o]=u(t);return[a,o,r]}async function d(e){return"blob"===e.type?e.blob:"json"===e.type?new Blob([e.jsonString],{type:"application/json"}):(await(0,a.Z)(e.url,{responseType:"blob"})).data}function f(e,t){if(!e.hasPath())return null;const[r,,a]=p(e.path);return e.portalItem.resourceFromPath((0,n.v_)(r,t+a))}},83415:function(e,t,r){r.d(t,{H:function(){return i},b:function(){return c}});var a=r(70375),o=r(78668),n=r(12173),s=r(68611);async function i(e,t,r){const a=await l(e,t,r);await u(a,t,r)}async function c(e,t,r,a,o){const n=await l(r,a,o);await e.update({data:t}),await u(n,a,o)}async function l(e,t,i){if(!t?.resources)return;const c=t.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=t.portalItem;const l=new Set(t.resources.toKeep.map((e=>e.resource.path))),u=new Set,p=[];l.forEach((t=>{c.delete(t),e.paths.push(t)}));const d=[],f=[],m=[];for(const r of t.resources.toUpdate)if(c.delete(r.resource.path),l.has(r.resource.path)||u.has(r.resource.path)){const{resource:t,content:a,finish:o}=r,i=(0,s.W7)(t,(0,n.DO)());e.paths.push(i.path),d.push({resource:i,content:await(0,s.FO)(a),compress:r.compress}),o&&m.push((()=>o(i)))}else{e.paths.push(r.resource.path),f.push({resource:r.resource,content:await(0,s.FO)(r.content),compress:r.compress});const t=r.finish;t&&m.push((()=>t(r.resource))),u.add(r.resource.path)}for(const r of t.resources.toAdd)if(e.paths.push(r.resource.path),c.has(r.resource.path))c.delete(r.resource.path);else{d.push({resource:r.resource,content:await(0,s.FO)(r.content),compress:r.compress});const e=r.finish;e&&m.push((()=>e(r.resource)))}if(d.length||f.length){const{addOrUpdateResources:e}=await Promise.resolve().then(r.bind(r,68611));await e(t.portalItem,d,"add",i),await e(t.portalItem,f,"update",i)}if(m.forEach((e=>e())),0===p.length)return c;const w=await(0,o.UO)(p);if((0,o.k_)(i),w.length>0)throw new a.Z("save:resources","Failed to save one or more resources",{errors:w});return c}async function u(e,t,r){if(!e||!t.portalItem)return;const a=[];for(const o of e){const e=t.portalItem.resourceFromPath(o);a.push(e.portalItem.removeResource(e,r))}await(0,o.as)(a)}},76990:function(e,t,r){r.d(t,{w:function(){return s}});var a=r(51366),o=r(70375),n=r(99522);function s(e){if(a.default.apiKey&&(0,n.r)(e.portal.url))throw new o.Z("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${e.portal.url} when using an api key`)}},60629:function(e,t,r){r.d(t,{P:function(){return o},z:function(){return s}});var a=r(70375);async function o(e){const t=[];for(const r of e.allLayers)if("beforeSave"in r&&"function"==typeof r.beforeSave){const e=r.beforeSave();e&&t.push(e)}await Promise.allSettled(t)}const n=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function s(e,t,r){let o=(e.messages??[]).filter((({type:e})=>"error"===e)).map((({name:e,message:t,details:r})=>new a.Z(e,t,r)));if(e.blockedRelativeUrls&&(o=o.concat(e.blockedRelativeUrls.map((e=>new a.Z("url:unsupported",`Relative url '${e}' is not supported`))))),r){const{ignoreUnsupported:e,supplementalUnsupportedErrors:t=[],requiredPropertyChecksDisabled:a}=r;e&&(o=o.filter((({name:e})=>!(n.has(e)||t.includes(e))))),a&&(o=o.filter((e=>"web-document-write:property-required"!==e.name)))}if(o.length>0)throw new a.Z(t.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:o})}},15967:function(e,t,r){r.d(t,{save:function(){return I},saveAs:function(){return k}});var a=r(70375),o=r(15842),n=r(76868),s=r(3466),i=r(50516),c=r(14685),l=r(35925),u=r(39536),p=r(20692),d=r(54957),f=r(93968),m=r(53110),w=r(84513),h=r(31370),y=r(94466),g=r(41268),v=r(64573),b=r(83415),_=r(76990),R=r(60629);const P=["NatGeo_World_Map","Ocean_Basemap","USA_Topo_Maps","World_Imagery","World_Street_Map","World_Terrain_Base","World_Topo_Map","World_Hillshade","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Reference/World_Boundaries_and_Places","Reference/World_Reference_Overlay","Reference/World_Transportation"].map((e=>e.toLowerCase()));async function I(e,t,r){r??={},function(e,t){if(!t.portalItem)throw new a.Z(`${e.name}:portal-item-not-set`,"Portal item to save to has not been set on the WebMap");(0,_.w)(t.portalItem),O(e,t.portalItem)}(e,t),await(0,n.N1)((()=>!t.updatingFromView)),await t.load(),await W(t),await(0,R.P)(t),await S(e,t);const o=t.portalItem,s=(0,w.Y)(o,"web-map",!0),i=t.write({},s);return await Promise.all(s.resources.pendingOperations),(0,R.z)(s,{errorName:`${e.name}:save`},r),await A(t,o),await async function(e,t,r,a,o){await r.update({data:a}),G(e,t,r,a,o)}(e,t,o,i,s),await Promise.all([t.updateItemThumbnail(),(0,b.H)(t.resourceReferences,s)]),o}async function k(e,t,r,o){o??={};const i=function(e,t){let r=m.default.from(t);return r.id&&(r=r.clone(),r.id=null),r.type||(r.type=e.itemType),r.portal||(r.portal=f.Z.getDefault()),(0,_.w)(r),O(e,r),r}(e,r);await(0,n.N1)((()=>!t.updatingFromView)),await t.load(),function(e,t){const r=t.allLayers.filter((e=>"unsupported"===e.type&&"KnowledgeGraphLayer"===e.resourceInfo?.layerType));if(r.length)throw new a.Z(`${e.name}:save-as-invalid-configuration`,`Failed to save a copy of ${e.name} to prevent persisting invalid configuration. See 'details.layers'`,{layers:r.toArray()})}(e,t),await W(t),await(0,R.P)(t),await S(e,t);const c=(0,w.Y)(i,"web-map",!0),l=t.write({},c);await Promise.all(c.resources.pendingOperations),(0,R.z)(c,{errorName:`${e.name}:save`},o),await async function(e,t){(0,h.ck)(t,T),(0,h.ck)(t,C),(0,h.ck)(t,h.hz.METADATA),(0,h.ck)(t,q),(0,h.ck)(t,x),(0,h.ck)(t,N),(0,h.ck)(t,F),(0,h.ck)(t,E),await A(e,t)}(t,i);const u=t.getThumbnailState();return await async function(e,t,r,o,n,i){const c=t.portalItem,l={item:c,authenticated:!(!c?.id||!c.portal.user)},u=r.portal;await u.signIn();const{copyAllowed:p,itemReloaded:d}=await async function(e,t){const{item:r,authenticated:a}=e;return r?.id&&r.typeKeywords?.includes("useOnly")?r.portal.portalHostname!==t.portalHostname?{copyAllowed:!1,itemReloaded:!1}:(a||await r.reload(),{copyAllowed:"admin"===r.itemControl||"update"===r.itemControl,itemReloaded:!0}):{copyAllowed:!0,itemReloaded:!1}}(l,u);if(l.authenticated||=d,!p)throw new a.Z(`${e.name}:save-as-copy-not-allowed`,"Owner of this map does not allow others to save a copy");const f=await async function(e,t,r,a){const o=e.portal,{item:n}=t,{folder:i,copyAllResources:c}=a;let l=!1;if(c&&n?.id&&(0,s.Zo)(n.portal.url,o.url)&&parseInt(n.portal.currentVersion,10)>=2023){const{total:e}=await n.fetchResources();l=!!e}if(l){const t=await n.copy({copyResources:"all",folder:i});e.id=t.id,e.portal=t.portal;const a=e.toJSON();await e.load(),e.read(a),await e.update({data:r})}else await(o.user?.addItem({item:e,folder:i,data:r}));return l}(r,l,o,i);return t.portalItem=r,G(e,t,r,o,n),f}(e,t,i,l,c,o)&&(t.resourceReferences.portalItem=i),t.restoreThumbnailFromState(u),await Promise.all([t.updateItemThumbnail(),(0,b.H)(t.resourceReferences,c)]),i}function O(e,t){if(t.type!==e.itemType)throw new a.Z(`${e.name}:portal-item-wrong-type`,`Portal item needs to have type "${e.itemType}"`)}async function S(e,t){if(!t.basemap?.baseLayers.length)throw new a.Z(`${e.name}:save`,"Map does not have a valid basemap with a base layer.");let r=null;if(await(0,n.N1)((()=>{const e=(0,v.Us)(t.initialViewProperties,t.basemap);return r=e.spatialReference,!e.updating})),!(0,l.fS)(r,t.initialViewProperties.spatialReference))throw new a.Z(`${e.name}:save`,"The spatial reference of the basemap is not compatible with the one from the map.",{expected:t.initialViewProperties.spatialReference,actual:r})}function W(e){const t=[];return e.basemap&&t.push(e.basemap.load()),e.ground&&t.push(e.ground.load()),Promise.allSettled(t).then((()=>{}))}async function A(e,t){t.extent=await async function(e,t){const a=t.clone().normalize();let o;if(a.length>1)for(const e of a)o?e.width>o.width&&(o=e):o=e;else o=a[0];return async function(e,t){const a=t.spatialReference;if(a.isWGS84)return t.clone();if(a.isWebMercator)return(0,u.Sx)(t);const{getGeometryServiceURL:o}=await r.e(8060).then(r.bind(r,8060)),n=await o(e),s=new g.Z;return s.geometries=[t],s.outSpatialReference=c.Z.WGS84,(await(0,y.i)(n,s))[0]}(e,o)}(e.portalItem,e.initialViewProperties.viewpoint.targetGeometry),await async function(e,t){(0,h.qj)(t,$),await function(e){const t=V(e).map((e=>e.load())).toArray();return Promise.allSettled(t).then((()=>{}))}(e),function(e,t){(0,h._$)(t,T)||(0,h._$)(t,F)||(0,h._$)(t,E)||(0,h._$)(t,N)||!z(e)?(0,h.ck)(t,U):(0,h.qj)(t,U)}(e,t),function(e,t){z(e)?(0,h.qj)(t,Z):(0,h.ck)(t,Z)}(e,t),function(e,t){!(0,h._$)(t,q)&&function(e){return V(e).filter((e=>"group"!==e.type)).every((t=>t.loaded&&function(e,t){return(0,d.fP)(t)&&t.capabilities.operations.supportsSync||function(e){return(0,d.rQ)(e)||"map-notes"===e.type||"route"===e.type}(t)&&!t.portalItem||("tile"===t.type||"vector-tile"===t.type)&&(t.capabilities.operations.supportsExportTiles||function(e){return"tile"===e.type&&(0,p.h3)(e.url)&&P.some((t=>e.url?.toLowerCase().includes("/"+t+"/")))}(t)||(0,v.aL)(t))&&t.spatialReference.equals(e.initialViewProperties.spatialReference)}(e,t)))}(e)?(0,h.qj)(t,D):(0,h.ck)(t,D)}(e,t),function(e,t){(0,v.zb)(e.basemap)?(0,h.qj)(t,M):(0,h.ck)(t,M)}(e,t),function(e,t){e.utilityNetworks?.length?(0,h.qj)(t,j):(0,h.ck)(t,j)}(e,t),function(e,t){e.ipsInfo?(0,h.qj)(t,L):(0,h.ck)(t,L)}(e,t),t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter(((e,t,r)=>r.indexOf(e)===t)))}(e,t)}const $=h.hz.JSAPI,T="CollectorDisabled",U="Collector",Z="Data Editing",q="OfflineDisabled",D="Offline",F="Workforce Project",E="Workforce Worker",N="Workforce Dispatcher",x="Offline Map Areas",C="FieldMapsDisabled",M=h.hz.DEVELOPER_BASEMAP,j="UtilityNetwork",L="IPS";function V(e){return e.allLayers.concat(e.allTables)}function z(e){return V(e).some((e=>e.loaded&&(0,d.fP)(e)&&e.capabilities.operations.supportsEditing&&e.editingEnabled&&("subtype-group"!==e.type||e.sublayers.some((e=>e.editingEnabled)))))}function G(e,t,r,a,n){o.w.prototype.read.call(t,{version:a.version,authoringApp:a.authoringApp,authoringAppVersion:a.authoringAppVersion},{origin:e.origin,ignoreDefaults:!0,url:r.itemUrl?(0,s.mN)(r.itemUrl):void 0}),(0,i.D)(n),t.resourceInfo=a}}}]);