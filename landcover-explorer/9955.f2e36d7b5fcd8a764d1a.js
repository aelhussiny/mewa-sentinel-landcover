"use strict";(self.webpackChunkimagery_explorer_apps=self.webpackChunkimagery_explorer_apps||[]).push([[9955],{66318:function(e,t,n){function r(e){return null!=u(e)||null!=i(e)}function s(e){return a.test(e)}function o(e){return u(e)??i(e)}function i(e){const t=new Date(e);return function(e,t){if(Number.isNaN(e.getTime()))return!1;let n=!0;if(c&&/\d+\W*$/.test(t)){const e=t.match(/[a-zA-Z]{2,}/);if(e){let t=!1,r=0;for(;!t&&r<=e.length;)t=!l.test(e[r]),r++;n=!t}}return n}(t,e)?Number.isNaN(t.getTime())?null:t.getTime()-6e4*t.getTimezoneOffset():null}function u(e){const t=a.exec(e);if(!t?.groups)return null;const n=t.groups,r=+n.year,s=+n.month-1,o=+n.day,i=+(n.hours??"0"),u=+(n.minutes??"0"),l=+(n.seconds??"0");if(i>23)return null;if(u>59)return null;if(l>59)return null;const c=n.ms??"0",d=c?+c.padEnd(3,"0").substring(0,3):0;let f;if(n.isUTC||!n.offsetSign)f=Date.UTC(r,s,o,i,u,l,d);else{const e=+n.offsetHours,t=+n.offsetMinutes;f=6e4*("+"===n.offsetSign?-1:1)*(60*e+t)+Date.UTC(r,s,o,i,u,l,d)}return Number.isNaN(f)?null:f}n.d(t,{mu:function(){return s},of:function(){return r},sG:function(){return o}});const a=/^(?:(?<year>-?\d{4,})-(?<month>\d{2})-(?<day>\d{2}))(?:T(?<hours>\d{2}):(?<minutes>\d{2}):(?<seconds>\d{2})(?:\.(?<ms>\d+))?)?(?:(?<isUTC>Z)|(?:(?<offsetSign>\+|-)(?<offsetHours>\d{2}):(?<offsetMinutes>\d{2})))?$/;const l=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,c=!Number.isNaN(new Date("technology 10").getTime())},69400:function(e,t,n){n.d(t,{Z:function(){return p}});var r=n(7753),s=n(70375),o=n(31355),i=n(13802),u=n(37116),a=n(24568),l=n(12065),c=n(117),d=n(28098),f=n(12102);const h=(0,u.Ue)();class p{constructor(e){this.geometryInfo=e,this._boundsStore=new c.H,this._featuresById=new Map,this._markedIds=new Set,this.events=new o.Z,this.featureAdapter=f.n}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let e=0;return this._featuresById.forEach((t=>{null!=t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(e){if(null==this.fullBounds)return null;const[t,n,r,s]=this.fullBounds;return{xmin:t,ymin:n,xmax:r,ymax:s,spatialReference:(0,d.S2)(e)}}add(e){this._add(e),this._emitChanged()}addMany(e){for(const t of e)this._add(t);this._emitChanged()}upsertMany(e){const t=e.map((e=>this._upsert(e)));return this._emitChanged(),t.filter(r.pC)}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(e){const t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}removeManyById(e){this._boundsStore.invalidateIndex();for(const t of e){const e=this._featuresById.get(t);e&&this._remove(e)}this._emitChanged()}forEachBounds(e,t){for(const n of e){const e=this._boundsStore.get(n.objectId);e&&t((0,u.JR)(h,e))}}getFeature(e){return this._featuresById.get(e)}has(e){return this._featuresById.has(e)}forEach(e){this._featuresById.forEach((t=>e(t)))}forEachInBounds(e,t){this._boundsStore.forEachInBounds(e,(e=>{t(this._featuresById.get(e))}))}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let e=!1;this._featuresById.forEach(((t,n)=>{this._markedIds.has(n)||(e=!0,this._remove(t))})),this._markedIds.clear(),e&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(e){if(!e)return;const t=e.objectId;if(null==t)return void i.Z.getLogger("esri.layers.graphics.data.FeatureStore").error(new s.Z("featurestore:invalid-feature","feature id is missing",{feature:e}));const n=this._featuresById.get(t);let r;if(this._markedIds.add(t),n?(e.displayId=n.displayId,r=this._boundsStore.get(t),this._boundsStore.delete(t)):null!=this.onFeatureAdd&&this.onFeatureAdd(e),!e.geometry?.coords?.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);r=(0,l.$)(null!=r?r:(0,a.Ue)(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),null!=r&&this._boundsStore.set(t,r),this._featuresById.set(t,e)}_upsert(e){const t=e?.objectId;if(null==t)return i.Z.getLogger("esri.layers.graphics.data.FeatureStore").error(new s.Z("featurestore:invalid-feature","feature id is missing",{feature:e})),null;const n=this._featuresById.get(t);if(!n)return this._add(e),e;this._markedIds.add(t);const{geometry:r,attributes:o}=e;for(const e in o)n.attributes[e]=o[e];return r&&(n.geometry=r,this._boundsStore.set(t,(0,l.$)((0,a.Ue)(),r,this.geometryInfo.hasZ,this.geometryInfo.hasM)??null)),n}_remove(e){null!=this.onFeatureRemove&&this.onFeatureRemove(e);const t=e.objectId;return this._markedIds.delete(t),this._boundsStore.delete(t),this._featuresById.delete(t),e}}},12065:function(e,t,n){n.d(t,{$:function(){return re},$g:function(){return se},EI:function(){return Q},GH:function(){return L},IN:function(){return w},Iv:function(){return k},J6:function(){return R},Jd:function(){return b},Nh:function(){return K},RZ:function(){return X},Uy:function(){return A},XA:function(){return $},Yn:function(){return z},cn:function(){return Y},dd:function(){return P},di:function(){return H},eG:function(){return O},fQ:function(){return T},hY:function(){return oe},h_:function(){return V},ks:function(){return B},lM:function(){return W},lz:function(){return ue},zj:function(){return ee}});var r=n(70375),s=n(13802),o=n(61681),i=n(37116),u=n(24568),a=n(53736),l=n(59958),c=n(61619),d=n(15540);function f(e,t){return e?t?4:3:t?3:2}const h=()=>s.Z.getLogger("esri.layers.graphics.featureConversionUtils"),p={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},y=(e,t,n,r,s,o)=>{e[n]=s,e[n+1]=o},g=(e,t,n,r,s,o)=>{e[n]=s,e[n+1]=o,e[n+2]=t[r+2]},m=(e,t,n,r,s,o)=>{e[n]=s,e[n+1]=o,e[n+2]=t[r+3]},_=(e,t,n,r,s,o)=>{e[n]=s,e[n+1]=o,e[n+2]=t[r+2],e[n+3]=t[r+3]};function I(e,t,n,r){if(e){if(n)return t&&r?_:g;if(t&&r)return m}else if(t&&r)return g;return y}function b({scale:e,translate:t},n){return Math.round((n-t[0])/e[0])}function w({scale:e,translate:t},n){return Math.round((t[1]-n)/e[1])}function F({scale:e,translate:t},n,r){return n*e[r]+t[r]}function T(e,t,n){return e?t?n?x(e):Z(e):n?M(e):E(e):null}function E(e){const t=e.coords;return{x:t[0],y:t[1]}}function S(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function Z(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function j(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function M(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function v(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function x(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function q(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function G(e,t){return e&&t?q:e?j:t?v:S}function P(e,t,n=G(null!=t.z,null!=t.m)){return n(e,t)}function k(e,t,n){if(null==e)return null;const r=f(t,n),s=[];for(let t=0;t<e.coords.length;t+=r){const n=[];for(let s=0;s<r;s++)n.push(e.coords[t+s]);s.push(n)}return t?n?{points:s,hasZ:t,hasM:n}:{points:s,hasZ:t}:n?{points:s,hasM:n}:{points:s}}function N(e,t,n=f(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const r=e.coords;let s=0;for(const e of t.points)for(let t=0;t<n;t++)r[s++]=e[t];return e}function R(e,t,n){if(!e)return null;const r=f(t,n),{coords:s,lengths:o}=e,i=[];let u=0;for(const e of o){const t=[];for(let n=0;n<e;n++){const e=[];for(let t=0;t<r;t++)e.push(s[u++]);t.push(e)}i.push(t)}return t?n?{paths:i,hasZ:t,hasM:n}:{paths:i,hasZ:t}:n?{paths:i,hasM:n}:{paths:i}}function C(e,t,n=f(t.hasZ,t.hasM)){const{lengths:r,coords:s}=e;let o=0;for(const e of t.paths){for(const t of e)for(let e=0;e<n;e++)s[o++]=t[e];r.push(e.length)}return e}function O(e,t,n){if(!e)return null;const r=f(t,n),{coords:s,lengths:o}=e,i=[];let u=0;for(const e of o){const t=[];for(let n=0;n<e;n++){const e=[];for(let t=0;t<r;t++)e.push(s[u++]);t.push(e)}i.push(t)}return t?n?{rings:i,hasZ:t,hasM:n}:{rings:i,hasZ:t}:n?{rings:i,hasM:n}:{rings:i}}function A(e,t,n=t.hasZ,r=t.hasM){return B(e,t.rings,n,r)}function B(e,t,n,r){const s=f(n,r),{lengths:o,coords:i}=e;let u=0;ae(e);for(const e of t){for(const t of e)for(let e=0;e<s;e++)i[u++]=t[e];o.push(e.length)}return e}const D=[],U=[];function $(e,t,n,r,s){D[0]=e;const[o]=z(U,D,t,n,r,s);return le(D),le(U),o}function z(e,t,n,s,o,i){if(le(e),!n){for(const n of t){const t=i?n.attributes[i]:void 0;e.push(new l.u_(null,n.attributes,null,t))}return e}switch(n){case"esriGeometryPoint":return function(e,t,n,r,s){const o=G(n,r);for(const{geometry:n,attributes:r}of t){const t=null!=n?o(new d.Z,n):null;e.push(new l.u_(t,r,null,s?r[s]:void 0))}return e}(e,t,s,o,i);case"esriGeometryMultipoint":return function(e,t,n,r,s){const o=f(n,r);for(const{geometry:n,attributes:r}of t){const t=null!=n?N(new d.Z,n,o):null;e.push(new l.u_(t,r,null,s?r[s]:void 0))}return e}(e,t,s,o,i);case"esriGeometryPolyline":return function(e,t,n,r,s){const o=f(n,r);for(const{geometry:n,attributes:r,centroid:i}of t){const t=null!=n?C(new d.Z,n,o):null,u=null!=i?P(new d.Z,i):null;e.push(new l.u_(t,r,u,s?r[s]:void 0))}return e}(e,t,s,o,i);case"esriGeometryPolygon":return function(e,t,n,r,s){for(const{geometry:o,centroid:i,attributes:u}of t){const t=null!=o?A(new d.Z,o,n,r):null,a=s?u[s]:void 0;null!=i?e.push(new l.u_(t,u,S(new d.Z,i),a)):e.push(new l.u_(t,u,null,a))}return e}(e,t,s,o,i);default:h().error("convertToFeatureSet:unknown-geometry",new r.Z(`Unable to parse unknown geometry type '${n}'`)),le(e)}return e}function Q(e,t,n,r){U[0]=e,J(D,U,t,n,r);const s=D[0];return le(D),le(U),s}function L(e,t,n){if(null==e)return null;const s=new d.Z;return"hasZ"in e&&null==t&&(t=e.hasZ),"hasM"in e&&null==n&&(n=e.hasM),(0,a.wp)(e)?G(null!=t?t:null!=e.z,null!=n?n:null!=e.m)(s,e):(0,a.oU)(e)?A(s,e,t,n):(0,a.l9)(e)?C(s,e,f(t,n)):(0,a.aW)(e)?N(s,e,f(t,n)):void h().error("convertFromGeometry:unknown-geometry",new r.Z(`Unable to parse unknown geometry type '${e}'`))}function H(e,t,n,s){const o=e&&("coords"in e?e:e.geometry);if(null==o)return null;switch(t){case"esriGeometryPoint":{let e=E;return n&&s?e=x:n?e=Z:s&&(e=M),e(o)}case"esriGeometryMultipoint":return k(o,n,s);case"esriGeometryPolyline":return R(o,n,s);case"esriGeometryPolygon":return O(o,n,s);default:return h().error("convertToGeometry:unknown-geometry",new r.Z(`Unable to parse unknown geometry type '${t}'`)),null}}function J(e,t,n,s,o){if(le(e),null==n)return function(e,t){for(const n of t)e.push({attributes:n.attributes});return e}(e,t);switch(n){case"esriGeometryPoint":return function(e,t,n,r){let s=E;n&&r?s=x:n?s=Z:r&&(s=M);for(const n of t){const{geometry:t,attributes:r}=n,o=null!=t?s(t):null;e.push({attributes:r,geometry:o})}return e}(e,t,s,o);case"esriGeometryMultipoint":return function(e,t,n,r){for(const{geometry:s,attributes:o}of t)e.push({attributes:o,geometry:null!=s?k(s,n,r):null});return e}(e,t,s,o);case"esriGeometryPolyline":return function(e,t,n,r){for(const{geometry:s,attributes:o}of t)e.push({attributes:o,geometry:null!=s?R(s,n,r):null});return e}(e,t,s,o);case"esriGeometryPolygon":return function(e,t,n,r){for(const{geometry:s,attributes:o,centroid:i}of t){const t=null!=s?O(s,n,r):null;if(null!=i){const n=E(i);e.push({attributes:o,centroid:n,geometry:t})}else e.push({attributes:o,geometry:t})}return e}(e,t,s,o);default:h().error("convertToFeatureSet:unknown-geometry",new r.Z(`Unable to parse unknown geometry type '${n}'`))}return e}function Y(e){const{objectIdFieldName:t,spatialReference:n,transform:r,fields:s,hasM:o,hasZ:i,features:u,geometryType:a,exceededTransferLimit:l,uniqueIdField:c,queryGeometry:d,queryGeometryType:f}=e,h={features:J([],u,a,i,o),fields:s,geometryType:a,objectIdFieldName:t,spatialReference:n,uniqueIdField:c,queryGeometry:H(d,f,!1,!1)};return r&&(h.transform=r),l&&(h.exceededTransferLimit=l),o&&(h.hasM=o),i&&(h.hasZ=i),h}function V(e,t){const n=new c.Z,{hasM:s,hasZ:o,features:i,objectIdFieldName:u,spatialReference:a,geometryType:l,exceededTransferLimit:d,transform:f,fields:p}=e;return p&&(n.fields=p),n.geometryType=l??null,n.objectIdFieldName=u??t??null,n.spatialReference=a??null,n.objectIdFieldName?(i&&z(n.features,i,l,o,s,n.objectIdFieldName),d&&(n.exceededTransferLimit=d),s&&(n.hasM=s),o&&(n.hasZ=o),f&&(n.transform=f),n):(h().error(new r.Z("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),n)}function W(e){const{transform:t,features:n,hasM:r,hasZ:s}=e;if(!t)return e;for(const e of n)null!=e.geometry&&se(e.geometry,e.geometry,r,s,t),null!=e.centroid&&se(e.centroid,e.centroid,r,s,t);return e.transform=null,e}function X(e,t){const{geometryType:n,features:r,hasM:s,hasZ:o}=t;if(!e)return t;for(let t=0;t<r.length;t++){const i=r[t],u=i.weakClone();u.geometry=new d.Z,K(u.geometry,i.geometry,s,o,n,e),i.centroid&&(u.centroid=new d.Z,K(u.centroid,i.centroid,s,o,"esriGeometryPoint",e)),r[t]=u}return t.transform=e,t}function K(e,t,n,r,s,o,i=n,u=r){if(ae(e),!t?.coords.length)return null;const a=p[s],{coords:l,lengths:c}=t,d=f(n,r),h=f(n&&i,r&&u),y=I(n,r,i,u);if(!c.length)return y(e.coords,l,0,0,b(o,l[0]),w(o,l[1])),ae(e,d,0),e;let g,m,_,F,T=0,E=0,S=E;for(const t of c){if(t<a)continue;let n=0;E=S,_=g=b(o,l[T]),F=m=w(o,l[T+1]),y(e.coords,l,E,T,_,F),n++,T+=d,E+=h;for(let r=1;r<t;r++,T+=d)_=b(o,l[T]),F=w(o,l[T+1]),_===g&&F===m||(y(e.coords,l,E,T,_-g,F-m),E+=h,n++,g=_,m=F);n>=a&&(e.lengths.push(n),S=E)}return le(e.coords,S),e.coords.length?e:null}function ee(e,t,n,r,s,o,i=n,u=r){if(ae(e),!t?.coords.length)return null;const a=p[s],{coords:l,lengths:c}=t,d=f(n,r),h=f(n&&i,r&&u),y=I(n,r,i,u);if(!c.length)return y(e.coords,l,0,0,l[0],l[1]),ae(e,d,0),e;let g=0;const m=o*o;for(const t of c){if(t<a){g+=t*d;continue}const n=e.coords.length/h,r=g,s=g+(t-1)*d;y(e.coords,l,e.coords.length,r,l[r],l[r+1]),ne(e.coords,l,d,m,y,r,s),y(e.coords,l,e.coords.length,s,l[s],l[s+1]);const o=e.coords.length/h-n;o>=a?e.lengths.push(o):le(e.coords,n*h),g+=t*d}return e.coords.length?e:null}function te(e,t,n,r){const s=e[t],o=e[t+1],i=e[n],u=e[n+1],a=e[r],l=e[r+1];let c=i,d=u,f=a-c,h=l-d;if(0!==f||0!==h){const e=((s-c)*f+(o-d)*h)/(f*f+h*h);e>1?(c=a,d=l):e>0&&(c+=f*e,d+=h*e)}return f=s-c,h=o-d,f*f+h*h}function ne(e,t,n,r,s,o,i){let u,a=r,l=0;for(let e=o+n;e<i;e+=n)u=te(t,e,o,i),u>a&&(l=e,a=u);a>r&&(l-o>n&&ne(e,t,n,r,s,o,l),s(e,t,e.length,l,t[l],t[l+1]),i-l>n&&ne(e,t,n,r,s,l,i))}function re(e,t,n,r){if(!t?.coords?.length)return null;const s=f(n,r);let o=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;if(t&&t.coords){const e=t.coords;for(let t=0;t<e.length;t+=s){const n=e[t],r=e[t+1];o=Math.min(o,n),l=Math.max(l,n),a=Math.min(a,r),c=Math.max(c,r)}}return(0,i.is)(e)?(0,i.bZ)(e,o,a,l,c):(0,u.al)(o,a,l,c,e),e}function se(e,t,n,r,s){const{coords:i,lengths:u}=t,a=f(n,r);if(!i.length)return e!==t&&ae(e),e;(0,o.O3)(s);const{originPosition:l,scale:c,translate:d}=s,h=ce;h.originPosition=l;const p=h.scale;p[0]=c[0]??1,p[1]=-(c[1]??1),p[2]=c[2]??1,p[3]=c[3]??1;const y=h.translate;if(y[0]=d[0]??0,y[1]=d[1]??0,y[2]=d[2]??0,y[3]=d[3]??0,!u.length){for(let t=0;t<a;++t)e.coords[t]=F(h,i[t],t);return e!==t&&ae(e,a,0),e}let g=0;for(let t=0;t<u.length;t++){const n=u[t];e.lengths[t]=n;for(let t=0;t<a;++t)e.coords[g+t]=F(h,i[g+t],t);let r=e.coords[g],s=e.coords[g+1];g+=a;for(let t=1;t<n;t++,g+=a){r+=i[g]*p[0],s+=i[g+1]*p[1],e.coords[g]=r,e.coords[g+1]=s;for(let t=2;t<a;++t)e.coords[g+t]=F(h,i[g+t],t)}}return e!==t&&ae(e,i.length,u.length),e}function oe(e,t,n,r,s,o){if(ae(e),e.lengths.push(...t.lengths),n===s&&r===o)for(let n=0;n<t.coords.length;n++)e.coords.push(t.coords[n]);else{const i=f(n,r),u=I(n,r,s,o),a=t.coords;for(let t=0;t<a.length;t+=i)u(e.coords,a,e.coords.length,t,a[t],a[t+1])}return e}function ie(e,t,n,r){let s=0,o=e[r*t],i=e[r*(t+1)];for(let u=1;u<n;u++){const n=o+e[r*(t+u)],a=i+e[r*(t+u)+1],l=(n-o)*(a+i);o=n,i=a,s+=l}return.5*s}function ue(e,t){const{coords:n,lengths:r}=e;let s=0,o=0;for(let e=0;e<r.length;e++){const i=r[e];o+=ie(n,s,i,t),s+=i}return Math.abs(o)}function ae(e,t=0,n=0){le(e.lengths,n),le(e.coords,t)}function le(e,t=0){e.length!==t&&(e.length=t)}const ce={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]}},59955:function(e,t,n){n.r(t),n.d(t,{default:function(){return F}});var r=n(66341),s=n(67979),o=n(70375),i=n(13802),u=n(78668),a=n(53736),l=n(35925),c=n(12065),d=n(69400),f=n(66069),h=n(66608),p=n(61957),y=n(40400),g=n(24366),m=n(28790),_=n(86349),I=n(14845),b=n(72559);const w={hasAttachments:!1,capabilities:"query, editing, create, delete, update",useStandardizedQueries:!0,supportsCoordinatesQuantization:!0,supportsReturningQueryGeometry:!0,advancedQueryCapabilities:{supportsQueryAttachments:!1,supportsStatistics:!0,supportsPercentileStatistics:!0,supportsReturningGeometryCentroid:!0,supportsQueryWithDistance:!0,supportsDistinct:!0,supportsReturningQueryExtent:!0,supportsReturningGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQueryWithResultType:!1,supportsSqlExpression:!0,supportsDisjointSpatialRel:!0}};class F{constructor(){this._queryEngine=null,this._snapshotFeatures=async e=>{const t=await this._fetch(e);return this._createFeatures(t)}}destroy(){this._queryEngine?.destroy(),this._queryEngine=this._createDefaultAttributes=null}async load(e,t={}){this._loadOptions={url:e.url,customParameters:e.customParameters};const n=[],[r]=await Promise.all([e.url?this._fetch(t?.signal):null,this._checkProjection(e.spatialReference)]),s=(0,p.my)(r,{geometryType:e.geometryType}),i=e.fields||s.fields||[],u=null!=e.hasZ?e.hasZ:s.hasZ,a=s.geometryType;let c=e.objectIdField||s.objectIdFieldName||"__OBJECTID";const f=e.spatialReference||l.YU;let g=e.timeInfo;i===s.fields&&s.unknownFields.length>0&&n.push({name:"geojson-layer:unknown-field-types",message:"Some fields types couldn't be inferred from the features and were dropped",details:{unknownFields:s.unknownFields}});const F=new m.Z(i);let T=F.get(c);T?("esriFieldTypeString"!==T.type&&(T.type="esriFieldTypeOID"),T.editable=!1,T.nullable=!1,c=T.name):(T={alias:c,name:c,type:"string"===s.objectIdFieldType?"esriFieldTypeString":"esriFieldTypeOID",editable:!1,nullable:!1},i.unshift(T));const E={};for(const e of i){if(null==e.name&&(e.name=e.alias),null==e.alias&&(e.alias=e.name),!e.name)throw new o.Z("geojson-layer:invalid-field-name","field name is missing",{field:e});if(!_.v.jsonValues.includes(e.type))throw new o.Z("geojson-layer:invalid-field-type",`invalid type for field "${e.name}"`,{field:e});if(e.name!==T.name){const t=(0,I.os)(e);void 0!==t&&(E[e.name]=t)}null==e.length&&(e.length=(0,I.ZR)(e))}if(g){if(g.startTimeField){const e=F.get(g.startTimeField);e?(g.startTimeField=e.name,e.type="esriFieldTypeDate"):g.startTimeField=null}if(g.endTimeField){const e=F.get(g.endTimeField);e?(g.endTimeField=e.name,e.type="esriFieldTypeDate"):g.endTimeField=null}if(g.trackIdField){const e=F.get(g.trackIdField);e?g.trackIdField=e.name:(g.trackIdField=null,n.push({name:"geojson-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:g}}))}g.startTimeField||g.endTimeField||(n.push({name:"geojson-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing",details:{timeInfo:g}}),g=null)}const S=a?(0,y.bU)(a):void 0,Z=F.dateFields.length?{timeZoneIANA:b.pt}:null,j={warnings:n,featureErrors:[],layerDefinition:{...w,drawingInfo:S??void 0,templates:(0,y.Hq)(E),extent:void 0,geometryType:a,objectIdField:c,fields:i,hasZ:!!u,timeInfo:g,dateFieldsTimeReference:Z}};this._queryEngine=new h.q({fieldsIndex:m.Z.fromLayerJSON({fields:i,timeInfo:g,dateFieldsTimeReference:Z}),geometryType:a,hasM:!1,hasZ:u,objectIdField:c,spatialReference:f,timeInfo:g,featureStore:new d.Z({geometryType:a,hasM:!1,hasZ:u}),cacheSpatialQueries:!0});const M=this._queryEngine.fieldsIndex.requiredFields.indexOf(T);M>-1&&this._queryEngine.fieldsIndex.requiredFields.splice(M,1),this._createDefaultAttributes=(0,y.Dm)(E,c);const v=await this._createFeatures(r);this._objectIdGenerator=this._createObjectIdGenerator(this._queryEngine,v);const x=this._normalizeFeatures(v,j.featureErrors);this._queryEngine.featureStore.addMany(x);const{fullExtent:q,timeExtent:G}=await this._queryEngine.fetchRecomputedExtents();if(j.layerDefinition.extent=q,G){const{start:e,end:t}=G;j.layerDefinition.timeInfo.timeExtent=[e,t]}return j}async applyEdits(e){const{spatialReference:t,geometryType:n}=this._queryEngine;return await Promise.all([(0,g.b)(t,n),(0,f._W)(e.adds,t),(0,f._W)(e.updates,t)]),await this._waitSnapshotComplete(),this._applyEdits(e)}async queryFeatures(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForIds(e,t.signal)}async queryExtent(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e,t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForSnapping(e,t.signal)}async refresh(e){this._loadOptions.customParameters=e,this._snapshotTask?.abort(),this._snapshotTask=(0,s.vr)(this._snapshotFeatures),this._snapshotTask.promise.then((e=>{this._queryEngine.featureStore.clear(),this._objectIdGenerator=this._createObjectIdGenerator(this._queryEngine,e);const t=this._normalizeFeatures(e);t&&this._queryEngine.featureStore.addMany(t)}),(e=>{this._queryEngine.featureStore.clear(),(0,u.D_)(e)||i.Z.getLogger("esri.layers.GeoJSONLayer").error(new o.Z("geojson-layer:refresh","An error occurred during refresh",{error:e}))})),await this._waitSnapshotComplete();const{fullExtent:t,timeExtent:n}=await this._queryEngine.fetchRecomputedExtents();return{extent:t,timeExtent:n}}async _createFeatures(e){if(null==e)return[];const{geometryType:t,hasZ:n,objectIdField:r}=this._queryEngine,s=(0,p.lG)(e,{geometryType:t,hasZ:n,objectIdField:r});if(!(0,l.fS)(this._queryEngine.spatialReference,l.YU))for(const e of s)null!=e.geometry&&(e.geometry=(0,c.GH)((0,f.iV)((0,c.di)(e.geometry,this._queryEngine.geometryType,this._queryEngine.hasZ,!1),l.YU,this._queryEngine.spatialReference)));return s}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch{}return this._waitSnapshotComplete()}}async _fetch(e){const{url:t,customParameters:n}=this._loadOptions,s=(await(0,r.Z)(t,{responseType:"json",query:{...n},signal:e})).data;return(0,p.O3)(s),s}_normalizeFeatures(e,t){const{objectIdField:n,fieldsIndex:r}=this._queryEngine,s=[];for(const o of e){const e=this._createDefaultAttributes(),i=(0,g.O0)(r,e,o.attributes,!0);i?t?.push(i):(this._assignObjectId(e,o.attributes,!0),o.attributes=e,o.objectId=e[n],s.push(o))}return s}async _applyEdits(e){const{adds:t,updates:n,deletes:r}=e,s={addResults:[],deleteResults:[],updateResults:[],uidToObjectId:{}};if(t?.length&&this._applyAddEdits(s,t),n?.length&&this._applyUpdateEdits(s,n),r?.length){for(const e of r)s.deleteResults.push((0,g.d1)(e));this._queryEngine.featureStore.removeManyById(r)}const{fullExtent:o,timeExtent:i}=await this._queryEngine.fetchRecomputedExtents();return{extent:o,timeExtent:i,featureEditResults:s}}_applyAddEdits(e,t){const{addResults:n}=e,{geometryType:r,hasM:s,hasZ:o,objectIdField:i,spatialReference:u,featureStore:l,fieldsIndex:d}=this._queryEngine,h=[];for(const s of t){if(s.geometry&&r!==(0,a.Ji)(s.geometry)){n.push((0,g.av)("Incorrect geometry type."));continue}const t=this._createDefaultAttributes(),o=(0,g.O0)(d,t,s.attributes);if(o)n.push(o);else{if(this._assignObjectId(t,s.attributes),s.attributes=t,null!=s.uid){const t=s.attributes[i];e.uidToObjectId[s.uid]=t}if(null!=s.geometry){const e=s.geometry.spatialReference??u;s.geometry=(0,f.iV)((0,g.og)(s.geometry,e),e,u)}h.push(s),n.push((0,g.d1)(s.attributes[i]))}}l.addMany((0,c.Yn)([],h,r,o,s,i))}_applyUpdateEdits({updateResults:e},t){const{geometryType:n,hasM:r,hasZ:s,objectIdField:o,spatialReference:i,featureStore:u,fieldsIndex:l}=this._queryEngine;for(const d of t){const{attributes:t,geometry:h}=d,p=t?.[o];if(null==p){e.push((0,g.av)(`Identifier field ${o} missing`));continue}if(!u.has(p)){e.push((0,g.av)(`Feature with object id ${p} missing`));continue}const y=(0,c.EI)(u.getFeature(p),n,s,r);if(null!=h){if(n!==(0,a.Ji)(h)){e.push((0,g.av)("Incorrect geometry type."));continue}const t=h.spatialReference??i;y.geometry=(0,f.iV)((0,g.og)(h,t),t,i)}if(t){const n=(0,g.O0)(l,y.attributes,t);if(n){e.push(n);continue}}u.add((0,c.XA)(y,n,s,r,o)),e.push((0,g.d1)(p))}}_createObjectIdGenerator(e,t){const n=e.fieldsIndex.get(e.objectIdField);if("esriFieldTypeString"===n.type)return()=>n.name+"-"+Date.now().toString(16);let r=Number.NEGATIVE_INFINITY;for(const e of t)e.objectId&&(r=Math.max(r,e.objectId));return r=Math.max(0,r)+1,()=>r++}_assignObjectId(e,t,n=!1){const r=this._queryEngine.objectIdField;e[r]=n&&r in t?t[r]:this._objectIdGenerator()}async _checkProjection(e){try{await(0,f._W)(l.YU,e)}catch{throw new o.Z("geojson-layer","Projection not supported")}}}},61957:function(e,t,n){n.d(t,{O3:function(){return T},lG:function(){return S},my:function(){return E},q9:function(){return c}});var r=n(66318),s=n(70375),o=n(35925),i=n(59958),u=n(15540),a=n(14845);const l={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function c(e){return l[e]}function*d(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const t of e.features)t&&(yield t)}}function*f(e){if(e)switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const t of e.coordinates)yield*t;break;case"MultiPolygon":for(const t of e.coordinates)for(const e of t)yield*e}}function h(e){for(const t of e)if(t.length>2)return!0;return!1}function p(e){let t=0;for(let n=0;n<e.length;n++){const r=e[n],s=e[(n+1)%e.length];t+=r[0]*s[1]-s[0]*r[1]}return t<=0}function y(e){const t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]||e.push(t),e}function g(e,t,n){switch(t.type){case"LineString":case"MultiPoint":return function(e,t,n){return I(e,t.coordinates,n),e}(e,t,n);case"MultiLineString":return function(e,t,n){for(const r of t.coordinates)I(e,r,n);return e}(e,t,n);case"MultiPolygon":return function(e,t,n){for(const r of t.coordinates){m(e,r[0],n);for(let t=1;t<r.length;t++)_(e,r[t],n)}return e}(e,t,n);case"Point":return function(e,t,n){return w(e,t.coordinates,n),e}(e,t,n);case"Polygon":return function(e,t,n){const r=t.coordinates;m(e,r[0],n);for(let t=1;t<r.length;t++)_(e,r[t],n);return e}(e,t,n)}}function m(e,t,n){const r=y(t);!function(e){return!p(e)}(r)?I(e,r,n):b(e,r,n)}function _(e,t,n){const r=y(t);!function(e){return p(e)}(r)?I(e,r,n):b(e,r,n)}function I(e,t,n){for(const r of t)w(e,r,n);e.lengths.push(t.length)}function b(e,t,n){for(let r=t.length-1;r>=0;r--)w(e,t[r],n);e.lengths.push(t.length)}function w(e,t,n){const[r,s,o]=t;e.coords.push(r,s),n.hasZ&&e.coords.push(o||0)}function F(e){switch(typeof e){case"string":return(0,r.mu)(e)?"esriFieldTypeDate":"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function T(e,t=4326){if(!e)throw new s.Z("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new s.Z("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:n}=e;if(!n)return;const r="string"==typeof n?n:"name"===n.type?n.properties.name:"EPSG"===n.type?n.properties.code:null,i=(0,o.oR)({wkid:t})?new RegExp(".*(CRS84H?|4326)$","i"):new RegExp(`.*(${t})$`,"i");if(!r||!i.test(r))throw new s.Z("geojson:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:n})}function E(e,t={}){const n=[],r=new Set,s=new Set;let o,i=!1,u=null,l=!1,{geometryType:p=null}=t,y=!1;for(const t of d(e)){const{geometry:e,properties:d,id:g}=t;if((!e||(p||(p=c(e.type)),c(e.type)===p))&&(i||(i=h(f(e))),l||(l=null!=g,l&&(o=typeof g,d&&(u=Object.keys(d).filter((e=>d[e]===g))))),d&&u&&l&&null!=g&&(u.length>1?u=u.filter((e=>d[e]===g)):1===u.length&&(u=d[u[0]]===g?u:[])),!y&&d)){let e=!0;for(const t in d){if(r.has(t))continue;const o=d[t];if(null==o){e=!1,s.add(t);continue}const i=F(o);if("unknown"===i){s.add(t);continue}s.delete(t),r.add(t);const u=(0,a.q6)(t);u&&n.push({name:u,alias:t,type:i})}y=e}}const g=(0,a.q6)(1===u?.length&&u[0]||null)??void 0;if(g)for(const e of n)if(e.name===g&&(0,a.H7)(e)){e.type="esriFieldTypeOID";break}return{fields:n,geometryType:p,hasZ:i,objectIdFieldName:g,objectIdFieldType:o,unknownFields:Array.from(s)}}function S(e,t){return Array.from(function*(e,t={}){const{geometryType:n,objectIdField:r}=t;for(const s of e){const{geometry:e,properties:o,id:a}=s;if(e&&c(e.type)!==n)continue;const l=o||{};let d;r&&(d=l[r],null==a||d||(l[r]=d=a));const f=new i.u_(e?g(new u.Z,e,t):null,l,null,d??void 0);yield f}}(d(e),t))}},40400:function(e,t,n){n.d(t,{Dm:function(){return c},Hq:function(){return d},MS:function(){return f},bU:function(){return u}});var r=n(39994),s=n(67134),o=n(10287),i=n(86094);function u(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?i.I4:"esriGeometryPolyline"===e?i.ET:i.lF}}}const a=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let l=1;function c(e,t){if((0,r.Z)("esri-csp-restrictions"))return()=>({[t]:null,...e});try{let n=`this.${t} = null;`;for(const t in e)n+=`this${a.test(t)?`.${t}`:`["${t}"]`} = ${JSON.stringify(e[t])};`;const r=new Function(`\n      return class AttributesClass$${l++} {\n        constructor() {\n          ${n};\n        }\n      }\n    `)();return()=>new r}catch(n){return()=>({[t]:null,...e})}}function d(e={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,s.d9)(e)}}]}function f(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:o.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}},24366:function(e,t,n){n.d(t,{O0:function(){return f},av:function(){return a},b:function(){return g},d1:function(){return c},og:function(){return y}});var r=n(66318),s=n(35925),o=n(14845);class i{constructor(){this.code=null,this.description=null}}class u{constructor(e){this.error=new i,this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error.description=e}}function a(e){return new u(e)}class l{constructor(e){this.globalId=null,this.success=!0,this.objectId=this.uniqueId=e}}function c(e){return new l(e)}const d=new Set;function f(e,t,n,r=!1){d.clear();for(const s in n){const i=e.get(s);if(!i)continue;const u=h(i,n[s]);if(d.add(i.name),i&&(r||i.editable)){const e=(0,o.Qc)(i,u);if(e)return a((0,o.vP)(e,i,u));t[i.name]=u}}for(const t of e?.requiredFields??[])if(!d.has(t.name))return a(`missing required field "${t.name}"`);return null}function h(e,t){let n=t;return(0,o.H7)(e)&&"string"==typeof t?n=parseFloat(t):(0,o.qN)(e)&&null!=t&&"string"!=typeof t?n=String(t):(0,o.y2)(e)&&"string"==typeof t&&(n=(0,r.sG)(t)),(0,o.Pz)(n)}let p;function y(e,t){if(!e||!(0,s.JY)(t))return e;if("rings"in e||"paths"in e){if(null==p)throw new TypeError("geometry engine not loaded");return p.simplify(t,e)}return e}async function g(e,t){!(0,s.JY)(e)||"esriGeometryPolygon"!==t&&"esriGeometryPolyline"!==t||await async function(){return null==p&&(p=await Promise.all([n.e(9067),n.e(3296)]).then(n.bind(n,8923))),p}()}}}]);